<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Switching from MemberInfo to AccessTools2 - BUTR Documentation</title><meta name=generator content="Hugo 0.107.0"><link href=https://butr.github.io/documentation//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://butr.github.io/documentation/advanced/switching-from-membertinfo-to-accesstools2/><link rel=stylesheet href=https://butr.github.io/documentation/css/theme.min.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://butr.github.io/documentation/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script>
<script src=https://butr.github.io/documentation/js/bundle.js></script><style>:root{}</style><meta property="og:title" content="Switching from MemberInfo to AccessTools2"><meta property="og:description" content="Introduction Using any of the MemberInfo types is slow. Especially when they are not cached.
A better way for accessing type members is to create delegates, with them the access speed is on pair with direct access.
Harmony created a helper class AccessTools for those cases and BUTR created an extended version of it.
In this article we&rsquo;ll show how you can speed up your code.
Caching Always cache the reflection if it&rsquo;s gonna be called multiple times."><meta property="og:type" content="article"><meta property="og:url" content="https://butr.github.io/documentation/advanced/switching-from-membertinfo-to-accesstools2/"><meta property="og:image" content="https://butr.github.io/documentation/images/og-image.png"><meta property="article:section" content="advanced"><meta property="article:published_time" content="2021-12-16T13:32:01+03:00"><meta property="article:modified_time" content="2021-12-16T13:32:01+03:00"><meta property="og:site_name" content="BUTR Documentation"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://butr.github.io/documentation/images/og-image.png"><meta name=twitter:title content="Switching from MemberInfo to AccessTools2"><meta name=twitter:description content="Introduction Using any of the MemberInfo types is slow. Especially when they are not cached.
A better way for accessing type members is to create delegates, with them the access speed is on pair with direct access.
Harmony created a helper class AccessTools for those cases and BUTR created an extended version of it.
In this article we&rsquo;ll show how you can speed up your code.
Caching Always cache the reflection if it&rsquo;s gonna be called multiple times."><meta itemprop=name content="Switching from MemberInfo to AccessTools2"><meta itemprop=description content="Introduction Using any of the MemberInfo types is slow. Especially when they are not cached.
A better way for accessing type members is to create delegates, with them the access speed is on pair with direct access.
Harmony created a helper class AccessTools for those cases and BUTR created an extended version of it.
In this article we&rsquo;ll show how you can speed up your code.
Caching Always cache the reflection if it&rsquo;s gonna be called multiple times."><meta itemprop=datePublished content="2021-12-16T13:32:01+03:00"><meta itemprop=dateModified content="2021-12-16T13:32:01+03:00"><meta itemprop=wordCount content="364"><meta itemprop=image content="https://butr.github.io/documentation/images/og-image.png"><meta itemprop=keywords content></head><body><div class=container><header><h1>BUTR Documentation</h1><a href=https://github.com/butr/documentation class=github><i class="fab fa-github"></i></a></header><div class=content-container><main><h1>Switching from MemberInfo to AccessTools2</h1><h1 id=introduction>Introduction</h1><p>Using any of the <code>MemberInfo</code> types is slow. Especially when they are not cached.<br>A better way for accessing type members is to create delegates, with them the access speed is on pair with direct access.<br>Harmony created a helper class <code>AccessTools</code> for those cases and BUTR created an extended version of it.<br>In this article we&rsquo;ll show how you can speed up your code.</p><h2 id=caching>Caching</h2><p>Always cache the reflection if it&rsquo;s gonna be called multiple times.</p><h2 id=harmony>Harmony</h2><p>We strongly recommend to check first the <a href=https://harmony.pardeike.net/articles/intro.html>Harmony Documentation</a> as the code base is based on it.<br>You will also need <a href=https://github.com/BUTR/Harmony.Extensions>Harmony.Extensions</a> for the <code>AccessTools2</code> class.</p><h2 id=accessing-fields>Accessing fields</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Usually it&#39;s done like this:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> FieldInfo? Info = AccessTools2.Field(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Info&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// And then invoked like this:</span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Info <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>string</span> str = Info.GetValue(obj);
</span></span><span style=display:flex><span>    Info.SetValue(obj, <span style=color:#e6db74>&#34;newstr&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Instead use AccessTools.FieldRef</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> AccessTools.FieldRef&lt;<span style=color:#66d9ef>string</span>, LauncherModuleVMType&gt;? Info = AccessTools2.FieldRefAccess&lt;<span style=color:#66d9ef>string</span>, LauncherModuleVMType&gt;(<span style=color:#e6db74>&#34;Info&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Info <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>string</span> str = Info(obj);
</span></span><span style=display:flex><span>    Info(obj) = <span style=color:#e6db74>&#34;newstr&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=calling-methods>Calling methods</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Usually it&#39;s done like this:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> MethodInfo? Method = AccessTools2.Method(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Method&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// And then invoked like this:</span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Method <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> b = Info.Invoke(obj, <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>object</span>[] {});
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Instead use AccessTools.FieldRef</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>delegate</span> <span style=color:#66d9ef>bool</span> MethodDelegate(LauncherModuleVM instance);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> MethodDelegate Method = AccessTools2.GetDelegate&lt;MethodDelegate&gt;(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Method&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Method <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> b = Info(obj);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=accessing-properties>Accessing properties</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Usually it&#39;s done like this:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> PropertyInfo? Name = AccessTools2.Property(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Name&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// And then invoked like this:</span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Name <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> b = Info.GetValue(obj);
</span></span><span style=display:flex><span>    Info.SetValue(obj, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Instead use AccessTools.FieldRef</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>delegate</span> <span style=color:#66d9ef>bool</span> GetNameDelegate(LauncherModuleVM instance);
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>delegate</span> <span style=color:#66d9ef>void</span> SetNameDelegate(LauncherModuleVM instance, <span style=color:#66d9ef>bool</span> @value);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> GetNameDelegate GetName = AccessTools2.GetPropertyGetterDelegate&lt;GetNameDelegate&gt;(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Name&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>readonly</span> SetNameDelegate SetName = AccessTools2.GetPropertySetterDelegate&lt;SetNameDelegate&gt;(<span style=color:#66d9ef>typeof</span>(LauncherModuleVM), <span style=color:#e6db74>&#34;Name&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LauncherModuleVM obj = ...; <span style=color:#75715e>// the LauncherModuleVM instance</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (GetName <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span> &amp;&amp; SetName <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> b = GetName(obj);
</span></span><span style=display:flex><span>    SetName(obj, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=edit-meta>Last updated on 16 Dec 2021<br>Published on 16 Dec 2021<br><a href=https://github.com/butr/documentation/edit/master/advanced/switching-from-membertinfo-to-accesstools2.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://butr.github.io/documentation/advanced/advanced-analytics-crash-reports/ title="Advanced Stacktrace Analytics of Crash Reports"><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Advanced Stacktrace Analytics of Crash Reports</a>
<a class="nav nav-next" href=https://butr.github.io/documentation/advanced/type-wrapping/ title="Type Wrapping">Next - Type Wrapping <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=open-menu><ul><li><a href=https://butr.github.io/documentation/>Home</a></li><li class=parent><a href=https://butr.github.io/documentation/advanced/>Advanced</a><ul class=sub-menu><li><a href=https://butr.github.io/documentation/advanced/publishing-on-github/>Publishing Mods on GitHub Actions (NexusMods, Steam Workshop, NuGet)</a></li><li><a href=https://butr.github.io/documentation/advanced/disabling-parts-of-external-functions/>Disabling Parts of External Functions</a></li><li><a href=https://butr.github.io/documentation/advanced/advanced-analytics-crash-reports/>Advanced Stacktrace Analytics of Crash Reports</a></li><li class=active><a href=https://butr.github.io/documentation/advanced/switching-from-membertinfo-to-accesstools2/>Switching from MemberInfo to AccessTools2</a></li><li><a href=https://butr.github.io/documentation/advanced/type-wrapping/>Type Wrapping</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>